<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Gestión de Deudas</title>
  <style>
    /* Estilos generales */
    body {
      margin: 0; padding: 0;
      font-family: 'Inter', sans-serif;
      background: #e0e0e0;
  
    }
    .container {
     padding: 1rem;
    }
    .card {
      background: #e0e0e0; border-radius: 12px;
      box-shadow: 6px 6px 16px #bebebe, -6px -6px 16px #ffffff;
      padding: 1rem; margin-bottom: 1rem;
    }
    h1, h2 { text-align: center; margin-bottom: .5rem; }
    /* Estilos del formulario */
form {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  justify-content: center;
  align-items: center;
  background: #fafafa;
  padding: 1rem;
  font-family: system-ui, sans-serif;
}

/* Inputs, selects y botones */
form input,
form select,
form button {
  flex: 1;
  min-width: 140px;
  padding: 0.6rem 0.8rem;
  background: #ffffff;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 1rem;
  color: #333;
  transition: border-color 0.2s, box-shadow 0.2s, transform 0.1s;
  outline: none;
}

/* Efecto al enfocar inputs y selects */
form input:focus,
form select:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}

/* Estilo del botón */
form button {
  cursor: pointer;
  border: none;
  background: #3b82f6;
  color: white;
  font-weight: 500;
  text-transform: uppercase;
}

/* Hover y active en botón */
form button:hover {
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}
form button:active {
  transform: scale(0.97);
}

/* Agrupación por fila */
.form-row {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  width: 100%;
  margin-top: 0.75rem;
}
.form-row > * {
  flex: 1;
  min-width: 120px;
}

    ul { list-style: none; padding: 0; margin: 1rem 0; }
    /* Deudas */
    #pagosList li,
    #deudasList li {
      background: #e0e0e0; border-radius: 8px;
      box-shadow: 4px 4px 8px #bebebe, -4px -4px 8px #ffffff;
      margin-bottom: .5rem; padding: .75rem;
      display: flex; flex-wrap: wrap; align-items: center;
      gap: .5rem;
    }
    #deudasList li span.date {
      flex-basis: 100%;
      font-size: .9rem; color: #555;
    }
    #deudasList li span.desc {
      flex: 1;
      font-weight: bold;
    }
    #deudasList li span.original,
    #deudasList li span.restante {
      font-size: .9rem;
    }
    #deudasList li span.original::before { content: "Original: "; }
    #deudasList li span.restante::before { content: "Restante: "; }
    .actions {
      margin-left: auto; display: flex; align-items: center;
    }
    .actions button {
      margin-left: .5rem; padding: .25rem .5rem; font-size: .9rem;
      border-radius: 6px; border: none;
      box-shadow: 2px 2px 6px #bebebe, -2px -2px 6px #ffffff;
      cursor: pointer; background: #e0e0e0; transition: transform .1s;
    }
    .actions button:active { transform: scale(.95); }

    /* Pagos */

    .payment-info, .payment-account {
      display: flex; flex-direction: column;
    }
    .payment-info .extra, .payment-account .extra {
      font-size: .9rem; margin-bottom: .25rem;
    }
    .payment-info .desc { font-size: 1rem; }
    .payment-account .amount {
      font-weight: bold; font-size: 1.1rem; text-align: right;
    }

    /* Importar / Exportar */
    .import-export {
      display: flex; gap: .5rem; justify-content: center;
      margin-top: .5rem;
    }
    .import-export button {
      flex: 1;
      padding: .5rem;
      border: none; border-radius: 8px;
      background: #e0e0e0;
      box-shadow: 4px 4px 8px #bebebe, -4px -4px 8px #ffffff;
      cursor: pointer;
      transition: transform .1s;
    }
    .import-export button:active { transform: scale(.98); }

    .footer1{
      background: #e0e0e0; padding: .75rem 1rem;
      box-shadow: 6px -6px 16px #bebebe, -6px 6px 16px #ffffff;
      display: flex; justify-content: space-around; position: sticky; bottom: 0;
    }
    .footer1 div span {
      display: block; font-size: 1.1rem; font-weight: bold;
    }
 .copyright {
   text-align: center;
   width: 100%;
    font-size: 14px;
    color: #999;
    margin-top: 20px;
  }

    /* Modal */
    .modal {
      display: none;
      position: fixed; z-index: 1000;
      left: 0; top: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      align-items: center; justify-content: center;
    }
    .modal-content {
      background: #fff; border-radius: 8px;
      padding: 1rem; max-width: 90%; width: 300px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      position: relative;
    }
    .modal-close {
      position: absolute; top: 8px; right: 12px;
      font-size: 1.2rem; cursor: pointer;
    }
    .modal-body {
      margin-top: 1.5rem;
      font-size: 1rem; color: #333;
    }
    .modal-body textarea {
      width: 100%; height: 200px; padding: .5rem;
      border: 1px solid #bebebe; border-radius: 6px;
      resize: vertical;
    }
    .modal-body button {
      width: 100%; padding: .5rem;
      border: none; border-radius: 6px;
      background: #e0e0e0;
      box-shadow: 4px 4px 8px #bebebe, -4px -4px 8px #ffffff;
      cursor: pointer; margin-top: .5rem;
      transition: transform .1s;
    }
    .modal-body button:active { transform: scale(.98); }
  </style>
</head>
<body>

  <h1>Gestión de Deudas</h1>
  <div class="container">
    <!-- Formulario -->
    <div class="card">
      <form id="actionForm">
        <div class="form-row">
          <select id="actionType" onchange="toggleMode()">
            <option value="pago">Registrar Pago</option>
            <option value="nuevaDeuda">Nueva Deuda</option>
          </select>
        </div>
        <div class="form-row" id="row-desc">
          <input type="text" id="desc" placeholder="Descripción" required/>
        </div>
        <div class="form-row" id="row-amt">
          <input type="number" id="amt" placeholder="Monto" required min="0.01" step="0.01"/>
        </div>
        <div class="form-row" id="row-date">
          <input type="date" id="date"/>
        </div>
        <div class="form-row" id="row-deuda" style="display:none">
          <select id="deudaSelect"></select>
        </div>
        <div class="form-row">
          <button type="submit" id="submitBtn">Registrar Pago</button>
        </div>
      </form>
    </div>

    <!-- Deudas Pendientes -->
    <div class="card">
      <h2>Deudas Pendientes</h2>
      <ul id="deudasList"></ul>
    </div>

    <!-- Historial de Pagos -->
    <div class="card">
      <h2>Historial de Pagos</h2>
      <ul id="pagosList"></ul>
    </div>

    <!-- Importar / Exportar -->
    <div class="card">
      <h2>Importar / Exportar</h2>
      <div class="import-export">
        <button id="exportBtn">Exportar</button>
        <button id="importBtn">Importar</button>
      </div>
    </div>
  </div>

  <div class="footer1">
    <div>Total Deuda Restante: <span id="totalDeuda">0</span></div>
    <div>Total Pagado: <span id="totalPagado">0</span></div>
    
  </div>
  <p class="copyright">© 2025 IAEgo. Todos los derechos reservados.</p>

  <!-- Modal reutilizable -->
  <div id="modal" class="modal" onclick="hideModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <span class="modal-close" onclick="hideModal()">&times;</span>
      <div id="modal-body" class="modal-body"></div>
    </div>
  </div>

  <script>
    let deudas    = JSON.parse(localStorage.getItem('deudas') || '[]');
    let pagos     = JSON.parse(localStorage.getItem('pagos')  || '[]');
    let editIndex = null;
    const $ = id => document.getElementById(id);

    // Asegurar campo original en deudas
    deudas = deudas.map(d => {
      if (typeof d.original === 'undefined') d.original = d.restante;
      return d;
    });

    function getCurrentDate() {
      const today = new Date();
      const y = today.getFullYear();
      const m = String(today.getMonth() + 1).padStart(2, '0');
      const d = String(today.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }

    const save = () => {
      localStorage.setItem('deudas', JSON.stringify(deudas));
      localStorage.setItem('pagos', JSON.stringify(pagos));
    };

    function showModal(html) {
      $('modal-body').innerHTML = html;
      $('modal').style.display    = 'flex';
    }
    function hideModal() {
      $('modal').style.display = 'none';
    }

    function toggleMode() {
      const isD = $('actionType').value === 'nuevaDeuda';
      $('row-deuda').style.display     = isD ? 'none' : 'flex';
      $('desc').required               = isD;
      $('submitBtn').textContent       = isD ? 'Añadir Deuda' : 'Registrar Pago';
      $('desc').placeholder            = isD ? 'Descripción de la Deuda' : 'Nota (opcional)';
    }

    function render() {
      // Render deudas
      let sumRest = 0;
      $('deudasList').innerHTML = deudas.map((d,i) => {
        sumRest += d.restante;
        return `
          <li>
            <span class="date">${d.date}</span>
            <span class="desc">${d.desc}</span>
            <span class="original">${d.original.toFixed(2)}</span>
            <span class="restante">${d.restante.toFixed(2)}</span>
            <div class="actions">
              <button onclick="delDebt(${i})">&times;</button>
            </div>
          </li>`;
      }).join('');
      $('totalDeuda').textContent = sumRest.toFixed(2);

      // Selector de deudas
      $('deudaSelect').innerHTML = deudas.map((d,i)=>
        `<option value="${i}">${d.desc} (${d.restante.toFixed(2)})</option>`
      ).join('');

      // Render pagos
      let sumP = 0;
      $('pagosList').innerHTML = pagos.map((p,i) => {
        sumP += p.amt;
        const nom = deudas[p.deudaIndex]?.desc || '—';
        return `
          <li>
            <div class="payment-info">
              <span class="extra">${p.date}</span>
              <span class="desc">${p.desc || '(sin nota)'}</span>
            </div>
            <div class="payment-account">
              <span class="extra">${nom}</span>
              <span class="amount">${p.amt.toFixed(2)}</span>
            </div>
            <div class="actions">
              <button onclick="startEdit(${i})">✎</button>
              <button onclick="delPay(${i})">&times;</button>
            </div>
          </li>`;
      }).join('');
      $('totalPagado').textContent = sumP.toFixed(2);
    }

    function delDebt(i) {
      if (pagos.some(p=>p.deudaIndex===i)) {
        showModal('No puedes eliminar una deuda que ya tiene pagos.');
      } else {
        deudas.splice(i,1);
        save(); render();
      }
    }

    function delPay(i) {
      const p = pagos.splice(i,1)[0];
      deudas[p.deudaIndex].restante += p.amt;
      save(); render();
    }

    function startEdit(i) {
      const p = pagos[i];
      editIndex = i;
      $('actionType').value = 'pago';
      toggleMode();
      $('deudaSelect').value = p.deudaIndex;
      $('desc').value        = p.desc;
      $('amt').value         = p.amt;
      $('date').value        = p.date;
      $('submitBtn').textContent = 'Guardar Pago';
    }

    $('actionForm').onsubmit = e => {
      e.preventDefault();
      const m  = +$('amt').value;
      const dt = $('date').value || getCurrentDate();

      if ($('actionType').value === 'nuevaDeuda') {
        deudas.push({ desc: $('desc').value.trim(), original: m, restante: m, date: dt });
      } else {
        const di = +$('deudaSelect').value;
        if (editIndex !== null) {
          deudas[pagos[editIndex].deudaIndex].restante += pagos[editIndex].amt;
        }
        deudas[di].restante = Math.max(0, deudas[di].restante - m);
        const obj = { deudaIndex: di, desc: $('desc').value.trim(), amt: m, date: dt };
        if (editIndex === null) {
          pagos.push(obj);
        } else {
          pagos[editIndex] = obj;
          editIndex = null;
        }
      }

      $('actionForm').reset();
      $('date').value = getCurrentDate();
      toggleMode();
      save(); render();
    };

    // — Funciones Import/Export —

    function exportData() {
      const data = { deudas, pagos };
      const json = JSON.stringify(data, null, 2);
      showModal(`
        <textarea id="exportArea">${json}</textarea>
        <button onclick="copyExport()">Copiar JSON</button>
      `);
    }

    function copyExport() {
      const ta = document.getElementById('exportArea');
      ta.select();
      document.execCommand('copy');
      showModal('<p>JSON copiado al portapapeles.</p>');
    }

    function importData() {
      showModal(`
        <textarea id="importArea" placeholder="Pega aquí el JSON"></textarea>
        <button onclick="handleImport()">Importar datos</button>
      `);
    }

    function handleImport() {
      try {
        const raw = document.getElementById('importArea').value;
        const data = JSON.parse(raw);
        if (!Array.isArray(data.deudas) || !Array.isArray(data.pagos)) {
          throw 'El JSON debe tener arrays de "deudas" y "pagos".';
        }
        deudas = data.deudas;
        pagos  = data.pagos;
        save(); render(); hideModal();
      } catch (e) {
        showModal(`<p>JSON inválido: ${e}</p>`);
      }
    }

    // Inicialización
    window.addEventListener('DOMContentLoaded', () => {
      $('exportBtn').onclick = exportData;
      $('importBtn').onclick = importData;
      $('date').value = getCurrentDate();
      toggleMode();
      render();
    });
  </script>
</body>
</html>
